# マップレイアウト管理機能 - 使い方ガイド

## 概要

展示会の会場マップレイアウトをFirebaseで管理できるようになりました。これにより、**コードを変更せずに**会場の配置図を更新できます。

## ✨ メリット

✅ **コード変更不要**: 次回の展示会でFirebaseのデータを変更するだけ  
✅ **柔軟な設定**: 通路や壁、エントランスの位置を自由に変更可能  
✅ **複数展示会対応**: 過去・未来の展示会データを保存して切り替え  
✅ **簡単な管理**: Firebaseコンソールで直接編集可能  

## 📦 データ構造

### 1. `event_layouts` コレクション（展示会設定）

各展示会の基本設定を管理します。

```javascript
{
  eventName: "2025年春季展示会",
  eventDate: "2025-04-01",
  mapWidth: 700,           // マップの幅
  mapHeight: 500,          // マップの高さ
  backgroundColor: "#FAFAFA",
  gridSize: 10,
  active: true,            // 現在使用中のレイアウト（1つだけtrueにする）
  createdAt: Timestamp
}
```

### 2. `map_elements` コレクション（マップ要素）

通路、壁、エントランスなどの各要素を管理します。

```javascript
{
  eventId: "event_2025_spring",  // どの展示会に属するか
  type: "corridor",               // 要素の種類
  shape: "rect",                  // 図形（rect, circle, line）
  x: 20,                          // X座標
  y: 80,                          // Y座標
  width: 660,                     // 幅
  height: 30,                     // 高さ
  color: "#EEEEEE",              // 色（16進数）
  label: "横通路1",              // ラベル
  zIndex: 1,                      // 描画順序（小さい値が先）
  filled: true,                   // 塗りつぶし（オプション）
  strokeWidth: 2                  // 線の太さ（オプション）
}
```

### 要素の種類（type）

- `background`: 背景
- `wall`: 壁
- `corridor`: 通路
- `entrance`: エントランス
- `decoration`: 装飾（その他）

## 🚀 初回セットアップ

### ステップ1: 現在のレイアウトをFirebaseに保存

1. アプリを起動
2. 会場混雑状況画面を開く
3. 右上の「︙」メニューをタップ
4. **「マップレイアウト初期化」**を選択

これで、現在ハードコードされているレイアウトがFirebaseに保存されます。

### ステップ2: Firebaseコンソールで確認

1. Firebaseコンソールにアクセス
2. Firestoreデータベースを開く
3. `event_layouts` コレクションに `event_2025_default` が作成されていることを確認
4. `map_elements` コレクションに複数の要素（element_0, element_1...）が作成されていることを確認

## 🔧 次回の展示会での使い方

### 方法1: 既存のレイアウトをコピーして編集（推奨）

1. Firebaseコンソールで `event_layouts` を開く
2. 既存のレイアウト（例: `event_2025_default`）のデータをコピー
3. 新しいドキュメント（例: `event_2025_summer`）を作成してペースト
4. `eventName`, `eventDate` を変更
5. `active` を `false` に設定（最初は非アクティブ）

6. `map_elements` を開く
7. 既存の要素（`eventId` が `event_2025_default` のもの）をコピー
8. 新しい要素を作成し、`eventId` を `event_2025_summer` に変更
9. 座標やサイズを調整

10. 準備ができたら、新しい展示会の `active` を `true` に、古い展示会の `active` を `false` に変更

### 方法2: Firebaseコンソールで直接編集

#### 通路の位置を変更する例

1. `map_elements` コレクションを開く
2. 変更したい通路の要素（例: `element_4` が横通路1）を開く
3. `x`, `y`, `width`, `height` を変更
4. 保存

#### 新しい通路を追加する例

1. `map_elements` コレクションを開く
2. 新しいドキュメントを作成（例: `element_10`）
3. 以下のフィールドを設定:
   ```javascript
   {
     eventId: "event_2025_summer",
     type: "corridor",
     shape: "rect",
     x: 20,
     y: 400,
     width: 660,
     height: 30,
     color: "#EEEEEE",
     label: "横通路4",
     zIndex: 1
   }
   ```
4. 保存

#### 色を変更する例

1. 変更したい要素を開く
2. `color` フィールドを編集（例: `#EEEEEE` → `#FFCCCC`）
3. 保存

## 📱 アプリでの確認

1. アプリを再起動（または画面を再読み込み）
2. 会場混雑状況画面を開く
3. マップが新しいレイアウトで表示されることを確認

## 💡 Tips

### マップが更新されない場合

1. アプリを完全に再起動
2. Firebaseで `active: true` になっている展示会が1つだけか確認
3. `map_elements` の `eventId` が正しいか確認

### 色の指定方法

16進数カラーコードを使用します：
- `#FAFAFA`: 明るいグレー（背景）
- `#EEEEEE`: グレー（通路）
- `#BDBDBD`: 濃いグレー（壁）
- `#A1887F`: 茶色（エントランス）
- `#FFFFFF`: 白
- `#000000`: 黒

### 描画順序（zIndex）

小さい値が先に描画されます：
- `0`: 背景
- `1`: 通路・壁
- `2`: エントランス・装飾
- `3`: ブース（自動）

### 座標の考え方

- 原点 (0, 0) は左上
- X軸: 右方向に増加
- Y軸: 下方向に増加
- デフォルトのマップサイズ: 700 × 500

## 🔍 トラブルシューティング

### Q: マップが表示されない

A: `active: true` の展示会が存在するか確認してください。存在しない場合は、デフォルトのハードコードされたレイアウトが使用されます。

### Q: 要素が表示されない

A: 
1. `eventId` が正しいか確認
2. `zIndex` が他の要素より小さすぎないか確認
3. 座標がマップの範囲内（0-700, 0-500）にあるか確認

### Q: 色が反映されない

A: `color` フィールドが `#` で始まる16進数（例: `#EEEEEE`）になっているか確認してください。

## 📝 次のステップ

1. **管理画面の作成**: Firebaseコンソールの代わりに、専用の管理画面でドラッグ&ドロップでレイアウトを編集
2. **テンプレート機能**: よく使うレイアウトをテンプレートとして保存
3. **プレビュー機能**: 変更前に確認できる機能
4. **バージョン管理**: レイアウトの履歴を保存して以前のバージョンに戻せる機能

## 📞 サポート

問題が発生した場合は、以下の情報を含めてお問い合わせください：
- 展示会ID（`eventId`）
- 使用しているデバイス
- エラーメッセージ（コンソールログ）

