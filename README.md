# BLE Beacon App

BLEビーコンを使用した会場混雑状況監視アプリです。

## 機能

### 基本機能
- BLEビーコンの検出と来場者数のカウント
- リアルタイム混雑状況の表示
- ユーザー属性情報の収集（年齢、性別、職業など）
- 複数ユーザーロール（来場者、スタッフ、主催者、出展者）

### 新機能：スタッフ管理画面の混雑監視
- **ヒートマップ表示**: 会場全体の混雑状況を視覚的に確認
- **混雑度監視**: 設定可能な閾値（デフォルト25人）で混雑を自動検出
- **プッシュ通知**: 混雑が閾値を超えたブースで自動通知
- **リアルタイム監視**: 30秒ごとの自動チェック
- **警報一覧**: 混雑中のブースを一覧表示

## 技術仕様

### 使用技術
- Flutter 3.9+
- Firebase (Firestore, Cloud Messaging)
- BLE (Bluetooth Low Energy)
- ローカル通知

### 通知機能
- **混雑警報**: 「〜ブースが混雑しています（現在X人）」の形式
- **自動監視**: バックグラウンドでの継続監視
- **設定可能**: 混雑度の閾値を10〜50人の範囲で調整可能

## セットアップ

### 依存関係のインストール
```bash
flutter pub get
```

### 必要な権限
- 通知権限
- Bluetooth権限
- 位置情報権限

### Firebase設定
- `google-services.json` (Android)
- `GoogleService-Info.plist` (iOS)

## 使用方法

### スタッフ画面での混雑監視
1. スタッフとしてログイン
2. ヒートマップ表示で会場全体の状況を確認
3. 設定アイコンで混雑度閾値を調整
4. 混雑警報で問題のあるブースを特定
5. 自動通知でリアルタイムな状況把握

### 混雑度の色分け
- 🔵 青: 空いている（0人）
- 🟢 緑: やや空き（1-5人）
- 🟡 黄: 適度（6-15人）
- 🟠 橙: やや混雑（16-30人）
- 🔴 赤: 大混雑（31人以上）

## 開発者向け

### 通知サービスのカスタマイズ
`lib/services/notification_service.dart`で通知の内容やタイミングを調整できます。

### 混雑度の計算ロジック
`lib/screens/staff_screen.dart`の`_checkCrowdingLevels()`メソッドで監視ロジックを変更できます。

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。
